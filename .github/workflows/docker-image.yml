name: Docker Image CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3


    - name: install acme
      env: # Or as an environment variable
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}    
      run: |
        git clone https://github.com/acmesh-official/acme.sh.git
        cd ./acme.sh
        ./acme.sh --install -m zouaoui.faycal.p@gmail.com
        env
        /home/runner/.acme.sh/acme.sh --issue  -d tls.wedreamteam.com  --dns dns_aws --keylength 4096 --server letsencrypt
        cp /home/runner/.acme.sh/tls.wedreamteam.com/tls.wedreamteam.com.cer tls.wedreamteam.com.pem
        cp /home/runner/.acme.sh/tls.wedreamteam.com/tls.wedreamteam.com.key .
        pwd

      
    - name: Build the Docker image
      run: cd $GITHUB_WORKSPACE &&  docker build . --file Dockerfile --tag tls:$(date +%s)
